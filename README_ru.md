### Yggrasil network peers checker / updater

Утилита предназначена для проверки доступности пиров и автоматического их обновления в конфигурационном файле Yggdrasil, а так же, с помощью метода admin API - addPeer.

Настроив автоматический запуск утилиты по расписанию, можно забыть о том, что публичные пиры иногда перестают работать и нужно их обновлять вручную.

**Внимание!** При обновлении пиров в конфигурационном файле, из него будут удалены все комментарии. Если вы не хотите терять комментарии, используйте эту утилиту без параметра `-u`, либо сделайте резервную копию файла с комментариями перед использованием.

```
Использование: peers_updater [ОПЦИИ]

Опции:
  -p, --print           Вывод отсортированного по задержке доступа списка пиров. При использовании этого параметра все другие параметры игнорируются.
  -c, --config <FILE>   Путь к конфигурационному файлу Yggdrasil [по-умолчанию: /etc/yggdrasil.conf или C:\ProgramData\Yggdrasil\yggdrasil.conf]
  -u, --update_cfg      Вносить изменения в конфигурационный файл. Если не указано, изменения в файл вноситься не будут.
  -a, --api             Добавлять/удалять пиры с помощью Admin API (требуется включение  admin API в настройках)
  -n, --number <VALUE>  Количество пиров, которое будет автоматически добавлено (без учета дополнительных пиров) [по-умолчанию: 3]
  -e, --extra <VALUE>   Разделенная пробелами строка с URI пиров, которые всегда должны быть в конфигурационном файле
  -i, --ignore <VALUE>  Разделенная пробелами строка с URI пиров, которые будут игнорироваться при добавлении в конфигурацию
  -r, --restart         Перезапускать сервис Yggdrasil (systemd или windows)
  -h, --help            Вывод этой справки
  -V, --version         Вывод версии
```

Чтобы просто вывести список пиров, отсортированный по времени отклика используйте параметр `-p`. При этом, все остальные параметры будут проигнорированы, никаких изменений в конфигурацию Yggrasil внесено не будет. 

Для того, чтобы утилита могла полноценно и корректно работать, внося измения в настройки Yggdrasil, у пользователя, с правами которого она запускается, должны быть соответствующие разрешения на изменение конфигурационного файла и/или использование Admin API.

Флаги `-r` (перезапустить Yggdrasil) и `-a` (использовать admin API) не имеет смысла использовать одновременно.

#### Примеры использования

Вывод отсортированного списка пиров:

```
peers_updater -p
```

Обновление пиров в конфигурационном файле по указанному пути (будет занесено два пира):

```
sudo ./peers_updater -c /home/user/tst/yggdrasil.conf -n 2 -u
```

Обновление пиров (будут добавлены 2 пира) в конфигурационном файле с путём к нему по-умолчанию, а так же, добавление пиров с использованием admin-API:

```
sudo ./peers_updater -n 2 -u -a
```

Обновление пиров (будут добавлены 2 пира) в конфигурационном файле с путём к нему по-умолчанию, а так же, добавление дополнительных пиров (в строке разделенной пробелами). Всего будет добавлено 4 пира:

```
sudo ./peers_updater -n 2 -u -a -e "tcp://my.favorite.peer.ru:7777 tls://i.love.ru:7777"
```

По расписанию утилиту можно запускать с помощью cron (Linux) или с помощью другого планировщика (Windows). 

##### Пример с запуском по расписанию
Обновлять конфигурационный файл по расписанию, вероятно, имеет смысл не чаще, чем раз в неделю. Т.к., мала вероятность того, что 2-3-4 пира, указанных в конфигурационном файле, одновременно перестанут работать в течении недели.

Запускаем редактор:
```
sudo crontab -e
```

В конец файла добавляем:
```
0 0 * * 0 /path/peers_updater -u -n 3 -r -c /etc/yggdrasil.conf >/dev/null 2>&1
```
Сохраняем изменения.

Теперь обновление пиров будет происходить по воскресеньям в 0 часов.

#### Сборка из исходников

Проект собирается без ошибок и предупреждений с cargo 1.65.0 и rustc 1.65.0.

```
git clone https://github.com/ygguser/peers_updater
cd peers_updater
cargo buid --release
```
